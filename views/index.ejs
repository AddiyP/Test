<head>
    <title>Beans Chat</title>
    <style>
        ul {
            list-style-type: none;
        }
    </style>
    <link rel="icon" href="https://images.unsplash.com/photo-1564894809611-1742fc40ed80?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MXx8YmVhbnN8ZW58MHx8MHx8&w=1000&q=80"></link>
</head>
<body>
    <h3 style="text-align: center"> Beans Chat </h3>
    <input type="text" id="username" placeholder="username">
    <button id="usernameBtn">Submit</button>
    <div class="message-box">
        <ul id="message-list"><li> </li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li><li>~</li></ul>
    </div>
    <div>
        <input type="text" id="message">
        <button type="button" id="messageBtn">Send</button>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>

<script>
const maxUsernameLength = 15;
const maxMessageLength = 30;
(function connect(){
    let socket = io.connect();

    let username = document.querySelector('#username');
    let usernameBtn = document.querySelector('#usernameBtn');
    
    username.addEventListener('keydown', e => {
        if (e.code === 'Enter')
        {
            console.log(username.value);
            socket.emit('change_username', {username: username.value});
            username.value = '';
        }
    });

    usernameBtn.addEventListener('click', e => {
        console.log(username.value);
        socket.emit('change_username', {username: username.value});
        username.value = '';
    });

    let message = document.querySelector('#message');
    let messageBtn = document.querySelector('#messageBtn');
    let messageList = document.querySelector('#message-list');

    message.addEventListener('keydown', e => {
        if (e.code === 'Enter')
        {
            console.log(message.value);
            socket.emit('new_message', {message: message.value});
            message.value = '';
        }
    });

    messageBtn.addEventListener('click', e => {
        console.log(message.value);
        socket.emit('new_message', {message: message.value});
        message.value = '';
    });
    
    const maxMessages = 15;
    messageList.childNodes[0].remove();
    socket.on('receive_message', data => {
        console.log(data);
        console.log('~' + messageList.childNodes.length);
        let listItem = document.createElement('li');
        listItem.innerHTML = '<a href="https://twitter.com/' + data.username + '" target="_blank">' + data.username + '</a>: ' + data.message;
        messageList.appendChild(listItem);
        if (messageList.childNodes.length > maxMessages)
        {
            messageList.childNodes[0].remove();
            console.log(messageList.childNodes.length);
        }
        
    });
})();
</script>
</body>
